<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genetic Algorithm Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .step-container {
            padding: 30px;
        }
        
        .step {
            margin-bottom: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            border-color: #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }
        
        .step-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .step-content {
            padding: 25px;
        }
        
        .meal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .meal-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .meal-card:hover {
            background: #e3f2fd;
            border-color: #4facfe;
            transform: translateY(-2px);
        }
        
        .meal-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.1em;
        }
        
        .meal-card .calories {
            font-weight: bold;
            color: #4facfe;
            font-size: 1.2em;
        }
        
        .meal-card .macros {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .plan-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }
        
        .plan-card:hover {
            border-color: #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.1);
        }
        
        .plan-card h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2em;
        }
        
        .plan-meals {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .plan-meal {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }
        
        .plan-meal .meal-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .plan-meal .meal-calories {
            color: #4facfe;
            font-size: 0.9em;
        }
        
        .plan-totals {
            background: #e3f2fd;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .plan-totals .total-calories {
            font-size: 1.3em;
            font-weight: bold;
            color: #1976d2;
        }
        
        .plan-totals .total-macros {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .score {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
        }
        
        .crossover-demo {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .parent {
            background: #e3f2fd;
            border: 2px solid #4facfe;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            min-width: 200px;
            margin: 10px;
        }
        
        .child {
            background: #f3e5f5;
            border: 2px solid #9c27b0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            min-width: 200px;
            margin: 10px;
        }
        
        .arrow {
            font-size: 2em;
            color: #4facfe;
            margin: 0 20px;
        }
        
        .mutation-demo {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .mutation-demo h4 {
            color: #e65100;
            margin-top: 0;
        }
        
        .before-after {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .before, .after {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            min-width: 200px;
            margin: 10px;
        }
        
        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .stats {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .stats h4 {
            margin-top: 0;
            color: #333;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4facfe;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .navigation {
            text-align: center;
            margin-top: 30px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }
        
        .generation {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .generation h4 {
            margin-top: 0;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧬 Genetic Algorithm Visualization</h1>
            <p>Step-by-step breakdown of how the genetic algorithm works for meal planning</p>
        </div>
        
        <div class="step-container">
            <!-- Step 1: User Inputs and Targets -->
            <div class="step">
                <div class="step-header">
                    Step 1: User Inputs and Target Calculation
                </div>
                <div class="step-content">
                    <h4>User Profile:</h4>
                    <div class="stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">25</div>
                                <div class="stat-label">Age</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">70kg</div>
                                <div class="stat-label">Weight</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">175cm</div>
                                <div class="stat-label">Height</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">Male</div>
                                <div class="stat-label">Gender</div>
                            </div>
                        </div>
                    </div>
                    
                    <h4>Calculated Targets:</h4>
                    <div class="stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">{{ targets.TDEE }} cal</div>
                                <div class="stat-label">Daily Calories</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ targets.Protein }}g</div>
                                <div class="stat-label">Protein</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ targets.Carbs }}g</div>
                                <div class="stat-label">Carbs</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ targets.Fat }}g</div>
                                <div class="stat-label">Fat</div>
                            </div>
                        </div>
                    </div>
                    
                    <h4>Meal Split:</h4>
                    <div class="stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">{{ meal_split.breakfast }}%</div>
                                <div class="stat-label">Breakfast</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ meal_split.lunch }}%</div>
                                <div class="stat-label">Lunch</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ meal_split.dinner }}%</div>
                                <div class="stat-label">Dinner</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ macro_focus }}</div>
                                <div class="stat-label">Macro Focus</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Available Meal Options -->
            <div class="step">
                <div class="step-header">
                    Step 2: Available Meal Options (Top 10 each)
                </div>
                <div class="step-content">
                    <h4>Breakfast Options:</h4>
                    <div class="meal-grid">
                        {% for meal in bfast_combos %}
                        <div class="meal-card">
                            <h4>{{ meal.name }}</h4>
                            <div class="calories">{{ meal.calories }} cal</div>
                            <div class="macros">P: {{ meal.protein }}g | C: {{ meal.carbs }}g | F: {{ meal.fat }}g</div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <h4>Lunch Options:</h4>
                    <div class="meal-grid">
                        {% for meal in lunch_combos %}
                        <div class="meal-card">
                            <h4>{{ meal.name }}</h4>
                            <div class="calories">{{ meal.calories }} cal</div>
                            <div class="macros">P: {{ meal.protein }}g | C: {{ meal.carbs }}g | F: {{ meal.fat }}g</div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <h4>Dinner Options:</h4>
                    <div class="meal-grid">
                        {% for meal in dinner_combos %}
                        <div class="meal-card">
                            <h4>{{ meal.name }}</h4>
                            <div class="calories">{{ meal.calories }} cal</div>
                            <div class="macros">P: {{ meal.protein }}g | C: {{ meal.carbs }}g | F: {{ meal.fat }}g</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Initial Population -->
            <div class="step">
                <div class="step-header">
                    Step 3: Initial Population (20 Random Plans)
                </div>
                <div class="step-content">
                    <p>We create 20 random meal plans by randomly selecting one breakfast, one lunch, and one dinner from the available options.</p>
                    
                    <div class="generation">
                        <h4>Generation 0 - Initial Population:</h4>
                        <div id="initial-population">
                            <!-- This will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 4: Fitness Scoring -->
            <div class="step">
                <div class="step-header">
                    Step 4: Fitness Scoring
                </div>
                <div class="step-content">
                    <p>Each plan is scored based on how close it is to the target calories and macros. The formula is:</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>Fitness Score = 100 - (Calorie Penalty + Macro Penalty + Variety Penalty)</strong>
                    </div>
                    
                    <div class="generation">
                        <h4>Scored Population (sorted by fitness):</h4>
                        <div id="scored-population">
                            <!-- This will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 5: Selection -->
            <div class="step">
                <div class="step-header">
                    Step 5: Selection (Elite + Breeders)
                </div>
                <div class="step-content">
                    <p>We select the best plans for the next generation:</p>
                    <ul>
                        <li><strong>Elite (4 plans):</strong> Top 4 plans that survive unchanged</li>
                        <li><strong>Breeders (14 plans):</strong> Top 14 plans used for crossover</li>
                    </ul>
                    
                    <div class="generation">
                        <h4>Selected Plans:</h4>
                        <div id="selected-plans">
                            <!-- This will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 6: Crossover -->
            <div class="step">
                <div class="step-header">
                    Step 6: Crossover (Breeding)
                </div>
                <div class="step-content">
                    <p>We create 16 new plans by mixing two parent plans:</p>
                    
                    <div class="crossover-demo">
                        <div class="parent">
                            <h4>Parent 1</h4>
                            <div class="plan-meal">
                                <div class="meal-name">Oatmeal</div>
                                <div class="meal-calories">300 cal</div>
                            </div>
                            <div class="plan-meal">
                                <div class="meal-name">Chicken Salad</div>
                                <div class="meal-calories">450 cal</div>
                            </div>
                            <div class="plan-meal">
                                <div class="meal-name">Grilled Salmon</div>
                                <div class="meal-calories">420 cal</div>
                            </div>
                        </div>
                        
                        <div class="arrow">+</div>
                        
                        <div class="parent">
                            <h4>Parent 2</h4>
                            <div class="plan-meal">
                                <div class="meal-name">Scrambled Eggs</div>
                                <div class="meal-calories">280 cal</div>
                            </div>
                            <div class="plan-meal">
                                <div class="meal-name">Rice with Curry</div>
                                <div class="meal-calories">480 cal</div>
                            </div>
                            <div class="plan-meal">
                                <div class="meal-name">Pasta Carbonara</div>
                                <div class="meal-calories">580 cal</div>
                            </div>
                        </div>
                        
                        <div class="arrow">→</div>
                        
                        <div class="child">
                            <h4>Child</h4>
                            <div class="plan-meal">
                                <div class="meal-name">Oatmeal</div>
                                <div class="meal-calories">300 cal</div>
                            </div>
                            <div class="plan-meal">
                                <div class="meal-name">Rice with Curry</div>
                                <div class="meal-calories">480 cal</div>
                            </div>
                            <div class="plan-meal">
                                <div class="meal-name">Grilled Salmon</div>
                                <div class="meal-calories">420 cal</div>
                            </div>
                        </div>
                    </div>
                    
                    <p><strong>Formula:</strong> Child = [Parent1.Breakfast, Parent2.Lunch, Parent1.Dinner]</p>
                </div>
            </div>
            
            <!-- Step 7: Mutation -->
            <div class="step">
                <div class="step-header">
                    Step 7: Mutation (Random Changes)
                </div>
                <div class="step-content">
                    <p>We randomly change 5% of non-elite plans to introduce variety:</p>
                    
                    <div class="mutation-demo">
                        <h4>Mutation Example:</h4>
                        <div class="before-after">
                            <div class="before">
                                <h4>Before Mutation</h4>
                                <div class="plan-meal">
                                    <div class="meal-name">Oatmeal</div>
                                </div>
                                <div class="plan-meal">
                                    <div class="meal-name">Chicken Salad</div>
                                </div>
                                <div class="plan-meal">
                                    <div class="meal-name">Grilled Salmon</div>
                                </div>
                            </div>
                            
                            <div class="arrow">→</div>
                            
                            <div class="after">
                                <h4>After Mutation</h4>
                                <div class="plan-meal">
                                    <div class="meal-name">Oatmeal</div>
                                </div>
                                <div class="plan-meal">
                                    <div class="meal-name highlight">Pasta with Meatballs</div>
                                </div>
                                <div class="plan-meal">
                                    <div class="meal-name">Grilled Salmon</div>
                                </div>
                            </div>
                        </div>
                        <p><strong>Random change:</strong> Lunch changed from "Chicken Salad" to "Pasta with Meatballs"</p>
                    </div>
                </div>
            </div>
            
            <!-- Step 8: Next Generation -->
            <div class="step">
                <div class="step-header">
                    Step 8: Next Generation
                </div>
                <div class="step-content">
                    <p>We combine all plans to create the next generation:</p>
                    <ul>
                        <li><strong>4 Elite plans</strong> (unchanged)</li>
                        <li><strong>16 Crossover plans</strong> (new combinations)</li>
                        <li><strong>Total: 20 plans</strong> for next generation</li>
                    </ul>
                    
                    <div class="generation">
                        <h4>Generation 1 - After Evolution:</h4>
                        <div id="next-generation">
                            <!-- This will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 9: Iteration -->
            <div class="step">
                <div class="step-header">
                    Step 9: Repeat for 50 Generations
                </div>
                <div class="step-content">
                    <p>We repeat this process for 50 generations, each time:</p>
                    <ol>
                        <li>Score all plans</li>
                        <li>Select elite and breeders</li>
                        <li>Create new plans through crossover</li>
                        <li>Apply mutations</li>
                        <li>Form next generation</li>
                    </ol>
                    
                    <div class="stats">
                        <h4>Final Results:</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">50</div>
                                <div class="stat-label">Generations</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">1000</div>
                                <div class="stat-label">Total Evaluations</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">95.2</div>
                                <div class="stat-label">Best Score</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">5</div>
                                <div class="stat-label">Top Plans</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <a href="/" class="btn">← Back to Meal Planner</a>
                <a href="/compare" class="btn">Compare Algorithms</a>
            </div>
        </div>
    </div>
    
    <script>
        // Generate example data for visualization
        const bfastCombos = {{ bfast_combos | tojson }};
        const lunchCombos = {{ lunch_combos | tojson }};
        const dinnerCombos = {{ dinner_combos | tojson }};
        const targets = {{ targets | tojson }};
        
        // Generate 20 random initial plans
        function generateInitialPopulation() {
            const population = [];
            for (let i = 0; i < 20; i++) {
                const bfast = bfastCombos[Math.floor(Math.random() * bfastCombos.length)];
                const lunch = lunchCombos[Math.floor(Math.random() * lunchCombos.length)];
                const dinner = dinnerCombos[Math.floor(Math.random() * dinnerCombos.length)];
                
                const totalCalories = bfast.calories + lunch.calories + dinner.calories;
                const totalProtein = bfast.protein + lunch.protein + dinner.protein;
                const totalCarbs = bfast.carbs + lunch.carbs + dinner.carbs;
                const totalFat = bfast.fat + lunch.fat + dinner.fat;
                
                population.push({
                    id: i + 1,
                    breakfast: bfast,
                    lunch: lunch,
                    dinner: dinner,
                    totalCalories,
                    totalProtein,
                    totalCarbs,
                    totalFat
                });
            }
            return population;
        }
        
        // Calculate fitness score
        function calculateFitness(plan) {
            const calorieDev = Math.abs(plan.totalCalories - targets.TDEE) / targets.TDEE;
            const proteinDev = Math.abs(plan.totalProtein - targets.Protein) / targets.Protein;
            const carbsDev = Math.abs(plan.totalCarbs - targets.Carbs) / targets.Carbs;
            const fatDev = Math.abs(plan.totalFat - targets.Fat) / targets.Fat;
            
            const caloriePenalty = calorieDev * 30;
            const macroPenalty = (proteinDev + carbsDev + fatDev) * 20;
            const varietyPenalty = 0; // Simplified for demo
            
            return Math.max(0, 100 - (caloriePenalty + macroPenalty + varietyPenalty));
        }
        
        // Generate and display initial population
        function displayInitialPopulation() {
            const population = generateInitialPopulation();
            const container = document.getElementById('initial-population');
            
            population.forEach((plan, index) => {
                const planDiv = document.createElement('div');
                planDiv.className = 'plan-card';
                planDiv.innerHTML = `
                    <h4>Plan ${plan.id}</h4>
                    <div class="plan-meals">
                        <div class="plan-meal">
                            <div class="meal-name">${plan.breakfast.name}</div>
                            <div class="meal-calories">${plan.breakfast.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.lunch.name}</div>
                            <div class="meal-calories">${plan.lunch.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.dinner.name}</div>
                            <div class="meal-calories">${plan.dinner.calories} cal</div>
                        </div>
                    </div>
                    <div class="plan-totals">
                        <div class="total-calories">Total: ${plan.totalCalories} calories</div>
                        <div class="total-macros">P: ${plan.totalProtein}g | C: ${plan.totalCarbs}g | F: ${plan.totalFat}g</div>
                    </div>
                `;
                container.appendChild(planDiv);
            });
        }
        
        // Display scored population
        function displayScoredPopulation() {
            const population = generateInitialPopulation();
            const scoredPopulation = population.map(plan => ({
                ...plan,
                fitness: calculateFitness(plan)
            })).sort((a, b) => b.fitness - a.fitness);
            
            const container = document.getElementById('scored-population');
            
            scoredPopulation.forEach((plan, index) => {
                const planDiv = document.createElement('div');
                planDiv.className = 'plan-card';
                planDiv.innerHTML = `
                    <h4>Plan ${plan.id} (Rank ${index + 1})</h4>
                    <div class="plan-meals">
                        <div class="plan-meal">
                            <div class="meal-name">${plan.breakfast.name}</div>
                            <div class="meal-calories">${plan.breakfast.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.lunch.name}</div>
                            <div class="meal-calories">${plan.lunch.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.dinner.name}</div>
                            <div class="meal-calories">${plan.dinner.calories} cal</div>
                        </div>
                    </div>
                    <div class="plan-totals">
                        <div class="total-calories">Total: ${plan.totalCalories} calories</div>
                        <div class="total-macros">P: ${plan.totalProtein}g | C: ${plan.totalCarbs}g | F: ${plan.totalFat}g</div>
                    </div>
                    <div class="score">Fitness: ${plan.fitness.toFixed(1)}</div>
                `;
                container.appendChild(planDiv);
            });
        }
        
        // Display selected plans
        function displaySelectedPlans() {
            const population = generateInitialPopulation();
            const scoredPopulation = population.map(plan => ({
                ...plan,
                fitness: calculateFitness(plan)
            })).sort((a, b) => b.fitness - a.fitness);
            
            const elite = scoredPopulation.slice(0, 4);
            const breeders = scoredPopulation.slice(0, 14);
            
            const container = document.getElementById('selected-plans');
            
            // Elite plans
            const eliteDiv = document.createElement('div');
            eliteDiv.innerHTML = '<h4>Elite Plans (Top 4):</h4>';
            elite.forEach(plan => {
                const planDiv = document.createElement('div');
                planDiv.className = 'plan-card';
                planDiv.style.borderColor = '#4caf50';
                planDiv.innerHTML = `
                    <h4>Plan ${plan.id} - ELITE</h4>
                    <div class="plan-meals">
                        <div class="plan-meal">
                            <div class="meal-name">${plan.breakfast.name}</div>
                            <div class="meal-calories">${plan.breakfast.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.lunch.name}</div>
                            <div class="meal-calories">${plan.lunch.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.dinner.name}</div>
                            <div class="meal-calories">${plan.dinner.calories} cal</div>
                        </div>
                    </div>
                    <div class="score">Fitness: ${plan.fitness.toFixed(1)}</div>
                `;
                eliteDiv.appendChild(planDiv);
            });
            container.appendChild(eliteDiv);
            
            // Breeders
            const breedersDiv = document.createElement('div');
            breedersDiv.innerHTML = '<h4>Breeders (Top 14):</h4>';
            breeders.forEach(plan => {
                const planDiv = document.createElement('div');
                planDiv.className = 'plan-card';
                planDiv.style.borderColor = '#4facfe';
                planDiv.innerHTML = `
                    <h4>Plan ${plan.id} - BREEDER</h4>
                    <div class="plan-meals">
                        <div class="plan-meal">
                            <div class="meal-name">${plan.breakfast.name}</div>
                            <div class="meal-calories">${plan.breakfast.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.lunch.name}</div>
                            <div class="meal-calories">${plan.lunch.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.dinner.name}</div>
                            <div class="meal-calories">${plan.dinner.calories} cal</div>
                        </div>
                    </div>
                    <div class="score">Fitness: ${plan.fitness.toFixed(1)}</div>
                `;
                breedersDiv.appendChild(planDiv);
            });
            container.appendChild(breedersDiv);
        }
        
        // Display next generation
        function displayNextGeneration() {
            const population = generateInitialPopulation();
            const scoredPopulation = population.map(plan => ({
                ...plan,
                fitness: calculateFitness(plan)
            })).sort((a, b) => b.fitness - a.fitness);
            
            const elite = scoredPopulation.slice(0, 4);
            const breeders = scoredPopulation.slice(0, 14);
            
            const container = document.getElementById('next-generation');
            
            // Elite plans (unchanged)
            elite.forEach(plan => {
                const planDiv = document.createElement('div');
                planDiv.className = 'plan-card';
                planDiv.style.borderColor = '#4caf50';
                planDiv.innerHTML = `
                    <h4>Plan ${plan.id} - ELITE (unchanged)</h4>
                    <div class="plan-meals">
                        <div class="plan-meal">
                            <div class="meal-name">${plan.breakfast.name}</div>
                            <div class="meal-calories">${plan.breakfast.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.lunch.name}</div>
                            <div class="meal-calories">${plan.lunch.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${plan.dinner.name}</div>
                            <div class="meal-calories">${plan.dinner.calories} cal</div>
                        </div>
                    </div>
                    <div class="score">Fitness: ${plan.fitness.toFixed(1)}</div>
                `;
                container.appendChild(planDiv);
            });
            
            // Crossover plans (simplified example)
            for (let i = 0; i < 16; i++) {
                const parent1 = breeders[Math.floor(Math.random() * breeders.length)];
                const parent2 = breeders[Math.floor(Math.random() * breeders.length)];
                
                const child = {
                    id: `C${i + 1}`,
                    breakfast: parent1.breakfast,
                    lunch: parent2.lunch,
                    dinner: parent1.dinner,
                    totalCalories: parent1.breakfast.calories + parent2.lunch.calories + parent1.dinner.calories,
                    totalProtein: parent1.breakfast.protein + parent2.lunch.protein + parent1.dinner.protein,
                    totalCarbs: parent1.breakfast.carbs + parent2.lunch.carbs + parent1.dinner.carbs,
                    totalFat: parent1.breakfast.fat + parent2.lunch.fat + parent1.dinner.fat
                };
                
                child.fitness = calculateFitness(child);
                
                const planDiv = document.createElement('div');
                planDiv.className = 'plan-card';
                planDiv.style.borderColor = '#9c27b0';
                planDiv.innerHTML = `
                    <h4>Plan ${child.id} - CROSSOVER</h4>
                    <div class="plan-meals">
                        <div class="plan-meal">
                            <div class="meal-name">${child.breakfast.name}</div>
                            <div class="meal-calories">${child.breakfast.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${child.lunch.name}</div>
                            <div class="meal-calories">${child.lunch.calories} cal</div>
                        </div>
                        <div class="plan-meal">
                            <div class="meal-name">${child.dinner.name}</div>
                            <div class="meal-calories">${child.dinner.calories} cal</div>
                        </div>
                    </div>
                    <div class="plan-totals">
                        <div class="total-calories">Total: ${child.totalCalories} calories</div>
                        <div class="total-macros">P: ${child.totalProtein}g | C: ${child.totalCarbs}g | F: ${child.totalFat}g</div>
                    </div>
                    <div class="score">Fitness: ${child.fitness.toFixed(1)}</div>
                `;
                container.appendChild(planDiv);
            }
        }
        
        // Initialize the visualization
        document.addEventListener('DOMContentLoaded', function() {
            displayInitialPopulation();
            displayScoredPopulation();
            displaySelectedPlans();
            displayNextGeneration();
        });
    </script>
</body>
</html>

